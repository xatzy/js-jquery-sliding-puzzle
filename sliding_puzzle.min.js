class SlidingPuzzle{constructor(i,e,t,s){this.image=i,this.drawTo=e,this.divideBy=t,this.animationSpeedMultiplier=s,this.containerCanvas=document.createElement("canvas"),this.pieceWidth=this.image.width/t,this.pieceHeight=this.image.height/t,this._constructPieces(),this._shufflePieces(),this.deletedImage=this._removeOnePiece(),this.containerCanvas.id="drawToCanvas",this.containerCanvas.width=this.image.width,this.containerCanvas.height=this.image.height,this.containerCanvas.style.position="absolute",this.containerCanvas.style.border="1px solid",$("#"+e).append(this.containerCanvas),this._addClickEventListener()}getRandomInt(i){return Math.floor(Math.random()*Math.floor(i))}manageClick(i,e){var t=Math.floor(i/this.pieceWidth),s=Math.floor(e/this.pieceHeight);let a=this._getEmptySpotPositionIfAround(t,s);if(null!=a.i&&null!=a.j){this._swapPieces(a.i,a.j,t,s);let i=a.i-t,e=a.j-s;if(i>0&&(i=1),i<0&&(i=-1),e>0&&(e=1),e<0&&(e=-1),this._win()){for(t=0;t<this.divideBy;t++)for(s=0;s<this.divideBy;s++)null==this.pieces[t][s].canvas&&(this.pieces[t][s].canvas=this.deletedImage);alert("Congratulations!"),this.drawBoard()}else this._drawPieceWithAnimation(a.i,a.j,{directioni:i,directionj:e})}}drawBoard(){for(var i=0;i<this.divideBy;i++)for(var e=0;e<this.divideBy;e++)this._drawPiece(i,e)}_addClickEventListener(){var i=this;$("#"+this.drawTo).click(function(e){var t=$(this).position().left,s=$(this).position().top;i.manageClick(e.pageX-t,e.pageY-s)})}_win(){for(var i=0;i<this.divideBy;i++)for(var e=0;e<this.divideBy;e++)if(this.pieces[i][e].startPosi!=i||this.pieces[i][e].startPosj!=e)return!1;return!0}_getEmptySpotPositionIfAround(i,e){let t={i:null,j:null};return null!=this.pieces[i][e].canvas&&(i>0&&null==this.pieces[i-1][e].canvas&&(t.i=i-1,t.j=e),e>0&&null==this.pieces[i][e-1].canvas&&(t.i=i,t.j=e-1),i+1<this.divideBy&&null==this.pieces[i+1][e].canvas&&(t.i=i+1,t.j=e),e+1<this.divideBy&&null==this.pieces[i][e+1].canvas&&(t.i=i,t.j=e+1)),t}_constructPieces(){this.pieces=[];for(var i=0;i<this.divideBy;i++)this.pieces[i]=[];for(i=0;i<this.divideBy;i++)for(var e=0;e<this.divideBy;e++){let t=this._getClippedRegion(this.image,i*this.pieceWidth,e*this.pieceHeight,this.pieceWidth,this.pieceHeight);this.pieces[i][e]={canvas:t,startPosi:i,startPosj:e}}}_shufflePieces(){for(var i=0;i<100;i++){let i=this.getRandomInt(this.divideBy),e=this.getRandomInt(this.divideBy),t=this.getRandomInt(this.divideBy),s=this.getRandomInt(this.divideBy);this._swapPieces(i,e,t,s)}}_removeOnePiece(){let i=this.getRandomInt(this.divideBy),e=this.getRandomInt(this.divideBy),t=this.pieces[i][e].canvas;return this.pieces[i][e].canvas=null,t}_swapPieces(i,e,t,s){var a=this.pieces[i][e];this.pieces[i][e]=this.pieces[t][s],this.pieces[t][s]=a}_drawPieceWithAnimation(i,e,t){let s=t.directioni,a=t.directionj;var n={drawAnimation:function(i,e,t,s,a,h,c){let d=function(){let n=c.containerCanvas.getContext("2d");n.clearRect((i-a)*c.pieceWidth,(e-h)*c.pieceHeight,c.pieceWidth,c.pieceHeight),null!=c.pieces[i][e].canvas&&n.drawImage(c.pieces[i][e].canvas,t,s,c.pieceWidth,c.pieceHeight)},o=Math.abs(s/c.pieceHeight+t/c.pieceWidth+a*c.animationSpeedMultiplier/c.pieceWidth+h*c.animationSpeedMultiplier/c.pieceHeight-(i+e+a+h));if(d(),0==a&&0==h){let t=c._getEmptySpotPositionIfAround(i,e);return i=t.i,e=t.j,void d()}o>1?window.requestAnimationFrame(function(){n.drawAnimation(i,e,t+a*c.animationSpeedMultiplier,s+h*c.animationSpeedMultiplier,a,h,c)}):window.requestAnimationFrame(function(){n.drawAnimation(i,e,i*c.pieceWidth,e*c.pieceHeight,0,0,c)})}};n.drawAnimation(i,e,(i-s)*this.pieceWidth,(e-a)*this.pieceHeight,s,a,this)}_drawPiece(i,e){let t=this.containerCanvas.getContext("2d");t.clearRect(i*this.pieceWidth,e*this.pieceHeight,this.pieceWidth,this.pieceHeight),null!=this.pieces[i][e].canvas&&t.drawImage(this.pieces[i][e].canvas,i*this.pieceWidth,e*this.pieceHeight,this.pieceWidth,this.pieceHeight)}_getClippedRegion(i,e,t,s,a){var n=document.createElement("canvas"),h=n.getContext("2d");return n.width=s,n.height=a,h.drawImage(i,e,t,s,a,0,0,s,a),n}}